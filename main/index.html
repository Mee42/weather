<!DOCTYPE html>
<html>
<head>
<title> ESP32 </title>

<script>



function getFile(event) {
	const input = event.target
  if ('files' in input && input.files.length > 0) {
	  placeFileContent(
      document.getElementById('content-target'),
      input.files[0])
  }
}

function placeFileContent(target, file) {
	readFileContent(file).then(content => {
  	target.value = content;
	const parser = new DOMParser();
	xml = parser.parseFromString(content, "text/xml");
	console.log(xml.getElementsByTagName("path"));
  }).catch(error => console.log(error))
}

function readFileContent(file) {
	const reader = new FileReader()
  return new Promise((resolve, reject) => {
    reader.onload = event => resolve(event.target.result)
    reader.onerror = error => reject(error)
    reader.readAsText(file)
  })
}

function submit_helper(a_t, a_hz, b_t, b_hz) {
    fetch('spin', {
        method: 'post',
        headers: {
            '_wb_a_ticks': a_t, // document.getElementById("a_ticks").value,
			'_wb_a_hz': a_hz, // document.getElementById("a_hz").value,
            '_wb_b_ticks': b_t, // document.getElementById("b_ticks").value,
			'_wb_b_hz': b_hz, // document.getElementById("b_hz").value,
        }
    });
}

function submit() {
	submit_helper(document.getElementById("a_ticks").value,
	    	document.getElementById("a_hz").value,
		    document.getElementById("b_ticks").value,	
		    document.getElementById("b_hz").value)	
}


const menus = ['manual', 'draw', 'info']
function activate(id) {
    for(x of menus)
        document.getElementById(x).style = "display: none";
    document.getElementById(id).style = "display: black";
}

function onload() {


	document.getElementById('input-file')
	  .addEventListener('change', getFile)

		document.body.addEventListener("keypress", e => {
		if(e.key == "a") {
			submit_helper(10, 200, 0, 200);
		} else if(e.key == "o") {
			submit_helper(-10, 200, 0, 200);
		} else if(e.key == "e") {
			submit_helper(0, 200, 10, 200);
		} else if(e.key == "u"){
			submit_helper(0, 200, -10, 200);
		}
	}); 

}

</script>

</head>

<body onload="onload()">

<h1> Whiteboard </h1>

<div style="display: flex; flex-direction: row">
<button onclick="activate('manual')">Manual</button>
<button onclick="activate('draw')">Draw</button>
<button onclick="activate('info')">Info</button>
</div>

<div>

<div id="manual" style="display: block">
	<h2>Manual Control</h2>
	A ticks: <input type="text" id="a_ticks"/>
	A hz: <input type="text" id="a_hz"/>
	<br/>
	B ticks: <input type="text" id="b_ticks"/>
	B hz: <input type="text" id="b_hz"/>
	<button onclick="submit()"> spin! </button>
</div>
<div id="draw" style="display: block">
	<h2>Draw</h2>
<div>
 <label for="input-file">Specify a file:</label><br>
 <input type="file" id="input-file">
</div>

<textarea id="content-target"></textarea>

</div>
<div id="info" style="display: block">

	<h2>Info</h2>
</div>

</div>




</div>


</body>


</html>


